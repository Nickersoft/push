{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/classes/Messages.js","src/classes/Permission.js","src/classes/Push.js","src/classes/Util.js","src/classes/agents/AbstractAgent.js","src/classes/agents/DesktopAgent.js","src/classes/agents/MSAgent.js","src/classes/agents/MobileChromeAgent.js","src/classes/agents/MobileFirefoxAgent.js","src/classes/agents/WebKitAgent.js","src/index.js"],"names":["f","exports","module","define","amd","window","global","self","this","Push","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","default","errors","incompatible","invalid_plugin","invalid_title","permission_denied","sw_notification_error","sw_registration_error","unknown_interface","Permission","_win","DEFAULT","GRANTED","DENIED","_permissions","get","arguments","undefined","_this","Notification","permission","webkitNotifications","checkPermission","requestPermission","then","catch","navigator","mozNotification","external","msIsSiteMode","_currentId","_notifications","_Permission2","_agents","desktop","_DesktopAgent2","chrome","_MobileChromeAgent2","firefox","_MobileFirefoxAgent2","ms","_MSAgent2","webkit","_WebKitAgent2","_configuration","serviceWorker","fallback","_removeNotification","isSupported","close","_Messages2","hasOwnProperty","_closeNotification","timeout","setTimeout","_addNotification","addEventListener","JSON","parse","data","action","Number","isInteger","id","_this2","_prepareNotification","_this3","_Util2","isFunction","onClose","create","_o","config","_serviceWorkerCallback","title","_t","_n","onShow","onError","onClick","isString","has","_this4","_createCallback","request","Promise","tag","isObject","objectMerge","plugin","Util","toString","_typeof","AbstractAgent","DesktopAgent","_AbstractAgent","icon","isUndefined","x32","body","requireInteraction","MSAgent","msSiteModeClearIconOverlay","msSiteModeSetIconOverlay","x16","msSiteModeActivate","MobileChromeAgent","match","register","ready","link","origin","document","location","href","getFunctionBody","Object","assign","showNotification","vibrate","silent","getNotifications","active","postMessage","message","MobileFirefoxAgent","createNotification","show","WebKitAgent","cancel","_Push2"],"mappings":"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","file":"push.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","const errorPrefix = 'PushError:';\n\nexport default {\n  errors: {\n    incompatible: `${errorPrefix} Push.js is incompatible with browser.`,\n    invalid_plugin: `${errorPrefix} plugin class missing from plugin manifest (invalid plugin). Please check the documentation.`,\n    invalid_title: `${errorPrefix} title of notification must be a string`,\n    permission_denied: `${errorPrefix} permission request declined`,\n    sw_notification_error: `${errorPrefix} could not show a ServiceWorker notification due to the following reason: `,\n    sw_registration_error: `${errorPrefix} could not register the ServiceWorker due to the following reason: `,\n    unknown_interface: `${errorPrefix} unable to create notification: unknown interface`,\n  }\n}\n","export default class Permission {\n\n  constructor(win) {\n    this._win = win;\n    this.DEFAULT = 'default';\n    this.GRANTED = 'granted';\n    this.DENIED = 'denied';\n    this._permissions = [\n      this.GRANTED,\n      this.DEFAULT,\n      this.DENIED\n    ];\n  }\n\n  /**\n   * Requests permission for desktop notifications\n   * @param {Function} onGranted - Function to execute once permission is granted\n   * @param {Function} onDenied - Function to execute once permission is denied\n   * @return {void}\n   */\n  request(onGranted, onDenied) {\n    const existing = this.get();\n\n    var resolve = (result = this._win.Notification.permission) => {\n      if (typeof(result)==='undefined' && this._win.webkitNotifications)\n        result = this._win.webkitNotifications.checkPermission();\n      if (result === this.GRANTED || result === 0) {\n        if (onGranted) onGranted();\n      } else if (onDenied) onDenied();\n    }\n\n    /* Permissions already set */\n    if (existing !== this.DEFAULT) {\n      resolve(existing);\n    }\n    /* Safari 6+, Legacy webkit browsers */\n    else if (this._win.webkitNotifications && this._win.webkitNotifications.checkPermission) {\n      this._win.webkitNotifications.requestPermission(resolve);\n    }\n    /* Chrome 23+ */\n    else if (this._win.Notification && this._win.Notification.requestPermission) {\n      this._win.Notification.requestPermission().then(resolve).catch(function () {\n        if (onDenied) onDenied();\n      });\n    }\n    /* Let the user continue by default */\n    else if (onGranted) {\n      onGranted();\n    }\n  }\n\n  /**\n   * Returns whether Push has been granted permission to run\n   * @return {Boolean}\n   */\n  has() {\n    return this.get() === this.GRANTED;\n  }\n\n  /**\n   * Gets the permission level\n   * @return {Permission} The permission level\n   */\n  get() {\n    let permission;\n\n    /* Safari 6+, Chrome 23+ */\n    if (this._win.Notification && this._win.Notification.permission)\n      permission = this._win.Notification.permission;\n\n    /* Legacy webkit browsers */\n    else if (this._win.webkitNotifications && this._win.webkitNotifications.checkPermission)\n      permission = this._permissions[this._win.webkitNotifications.checkPermission()];\n\n    /* Firefox Mobile */\n    else if (navigator.mozNotification)\n      permission = this.GRANTED;\n\n    /* IE9+ */\n    else if (this._win.external && this._win.external.msIsSiteMode)\n      permission = this._win.external.msIsSiteMode() ? this.GRANTED : this.DEFAULT;\n\n    else\n      permission = this.GRANTED;\n\n    return permission;\n  }\n}\n","import Messages from \"./Messages\";\nimport Permission from \"./Permission\";\nimport Util from \"./Util\";\n/* Import notification agents */\nimport DesktopAgent from \"./agents/DesktopAgent\";\nimport MobileChromeAgent from \"./agents/MobileChromeAgent\";\nimport MobileFirefoxAgent from \"./agents/MobileFirefoxAgent\";\nimport MSAgent from \"./agents/MSAgent\";\nimport WebKitAgent from \"./agents/WebKitAgent\";\n\nexport default class Push {\n\n  constructor(win) {\n    /* Private variables */\n\n    /* ID to use for new notifications */\n    this._currentId = 0;\n\n    /* Map of open notifications */\n    this._notifications = {};\n\n    /* Window object */\n    this._win = win;\n\n    /* Public variables */\n    this.Permission = new Permission(win);\n\n    /* Agents */\n    this._agents = {\n      desktop: new DesktopAgent(win),\n      chrome: new MobileChromeAgent(win),\n      firefox: new MobileFirefoxAgent(win),\n      ms: new MSAgent(win),\n      webkit: new WebKitAgent(win)\n    };\n\n    this._configuration = {\n      serviceWorker: '/serviceWorker.min.js',\n      fallback: function(payload) {}\n    }\n  }\n\n  /**\n   * Closes a notification\n   * @param {Notification} notification\n   * @return {Boolean} boolean denoting whether the operation was successful\n   * @private\n   */\n  _closeNotification(id) {\n    let success = true;\n    const notification = this._notifications[id];\n\n    if (notification !== undefined) {\n      success = this._removeNotification(id);\n\n      /* Safari 6+, Firefox 22+, Chrome 22+, Opera 25+ */\n      if (this._agents.desktop.isSupported())\n        this._agents.desktop.close(notification);\n\n      /* Legacy WebKit browsers */\n      else if (this._agents.webkit.isSupported())\n        this._agents.webkit.close(notification);\n\n      /* IE9 */\n      else if (this._agents.ms.isSupported())\n        this._agents.ms.close();\n\n      else {\n        success = false;\n        throw new Error(Messages.errors.unknown_interface);\n      }\n\n      return success;\n    }\n\n    return false;\n  }\n\n  /**\n   * Adds a notification to the global dictionary of notifications\n   * @param {Notification} notification\n   * @return {Integer} Dictionary key of the notification\n   * @private\n   */\n  _addNotification(notification) {\n    const id = this._currentId;\n    this._notifications[id] = notification;\n    this._currentId++;\n    return id;\n  }\n\n  /**\n   * Removes a notification with the given ID\n   * @param  {Integer} id - Dictionary key/ID of the notification to remove\n   * @return {Boolean} boolean denoting success\n   * @private\n   */\n  _removeNotification(id) {\n    let success = false;\n\n    if (this._notifications.hasOwnProperty(id)) {\n      /* We're successful if we omit the given ID from the new array */\n      delete this._notifications[id];\n      success = true;\n    }\n\n    return success;\n  }\n\n  /**\n   * Creates the wrapper for a given notification\n   *\n   * @param {Integer} id - Dictionary key/ID of the notification\n   * @param {Map} options - Options used to create the notification\n   * @returns {Map} wrapper hashmap object\n   * @private\n   */\n  _prepareNotification(id, options) {\n    let wrapper;\n\n    /* Wrapper used to get/close notification later on */\n    wrapper = {\n      get: () => {\n        return this._notifications[id];\n      },\n\n      close: () => {\n        this._closeNotification(id);\n      }\n    };\n\n    /* Autoclose timeout */\n    if (options.timeout) {\n      setTimeout(() => {\n        wrapper.close();\n      }, options.timeout);\n    }\n\n    return wrapper;\n  }\n\n  /**\n   * Find the most recent notification from a ServiceWorker and add it to the global array\n   * @param notifications\n   * @private\n   */\n  _serviceWorkerCallback(notifications, options, resolve) {\n    let id = this._addNotification(notifications[notifications.length - 1]);\n\n    /* Listen for close requests from the ServiceWorker */\n    navigator.serviceWorker.addEventListener('message', event => {\n      const data = JSON.parse(event.data);\n\n      if (data.action === 'close' && Number.isInteger(data.id))\n        this._removeNotification(data.id);\n    });\n\n    resolve(this._prepareNotification(id, options));\n  }\n\n  /**\n   * Callback function for the 'create' method\n   * @return {void}\n   * @private\n   */\n  _createCallback(title, options, resolve) {\n    let notification = null;\n    let onClose;\n\n    /* Set empty settings if none are specified */\n    options = options || {};\n\n    /* onClose event handler */\n    onClose = (id) => {\n      /* A bit redundant, but covers the cases when close() isn't explicitly called */\n      this._removeNotification(id);\n      if (Util.isFunction(options.onClose)) {\n        options.onClose.call(this, notification);\n      }\n    };\n\n    /* Safari 6+, Firefox 22+, Chrome 22+, Opera 25+ */\n    if (this._agents.desktop.isSupported()) {\n      try {\n        /* Create a notification using the API if possible */\n        notification = this._agents.desktop.create(title, options);\n      } catch (e) {\n        const id = this._currentId;\n        const sw = this.config().serviceWorker;\n        const cb = (notifications) => this._serviceWorkerCallback(notifications, options, resolve);\n        /* Create a Chrome ServiceWorker notification if it isn't supported */\n        if (this._agents.chrome.isSupported()) {\n          this._agents.chrome.create(id, title, options, sw, cb);\n        }\n      }\n      /* Legacy WebKit browsers */\n    } else if (this._agents.webkit.isSupported())\n      notification = this._agents.webkit.create(title, options);\n\n    /* Firefox Mobile */\n    else if (this._agents.firefox.isSupported())\n      this._agents.firefox.create(title, options);\n\n    /* IE9 */\n    else if (this._agents.ms.isSupported())\n      notification = this._agents.ms.create(title, options);\n\n    /* Default fallback */\n    else {\n      options.title = title;\n      this.config().fallback(options);\n    }\n\n    if (notification !== null) {\n      const id = this._addNotification(notification);\n      const wrapper = this._prepareNotification(id, options);\n\n      /* Notification callbacks */\n      if (Util.isFunction(options.onShow))\n        notification.addEventListener('show', options.onShow);\n\n      if (Util.isFunction(options.onError))\n        notification.addEventListener('error', options.onError);\n\n      if (Util.isFunction(options.onClick))\n        notification.addEventListener('click', options.onClick);\n\n      notification.addEventListener('close', () => {\n        onClose(id);\n      });\n\n      notification.addEventListener('cancel', () => {\n        onClose(id);\n      });\n\n      /* Return the wrapper so the user can call close() */\n      resolve(wrapper);\n    }\n\n    /* By default, pass an empty wrapper */\n    resolve(null);\n  }\n\n  /**\n   * Creates and displays a new notification\n   * @param {Array} options\n   * @return {Promise}\n   */\n  create(title, options) {\n    let promiseCallback;\n\n    /* Fail if no or an invalid title is provided */\n    if (!Util.isString(title)) {\n      throw new Error(Messages.errors.invalid_title);\n    }\n\n    /* Request permission if it isn't granted */\n    if (!this.Permission.has()) {\n      promiseCallback = (resolve, reject) => {\n        this.Permission.request(() => {\n          try {\n            this._createCallback(title, options, resolve);\n          } catch (e) {\n            reject(e);\n          }\n        }, () => {\n          reject(Messages.errors.permission_denied);\n        });\n      };\n    } else {\n      promiseCallback = (resolve, reject) => {\n        try {\n          this._createCallback(title, options, resolve);\n        } catch (e) {\n          reject(e);\n        }\n      };\n    }\n\n    return new Promise(promiseCallback);\n  }\n\n  /**\n   * Returns the notification count\n   * @return {Integer} The notification count\n   */\n  count() {\n    let count = 0;\n    let key;\n\n    for (key in this._notifications)\n      if (this._notifications.hasOwnProperty(key)) count++;\n\n    return count;\n  }\n\n  /**\n   * Closes a notification with the given tag\n   * @param {String} tag - Tag of the notification to close\n   * @return {Boolean} boolean denoting success\n   */\n  close(tag) {\n    let key, notification;\n\n    for (key in this._notifications) {\n      if (this._notifications.hasOwnProperty(key)) {\n        notification = this._notifications[key];\n\n        /* Run only if the tags match */\n        if (notification.tag === tag) {\n\n          /* Call the notification's close() method */\n          return this._closeNotification(key);\n        }\n      }\n    }\n  }\n\n  /**\n   * Clears all notifications\n   * @return {Boolean} boolean denoting whether the clear was successful in closing all notifications\n   */\n  clear() {\n    let key, success = true;\n\n    for (key in this._notifications)\n      if (this._notifications.hasOwnProperty(key))\n        success = success && this._closeNotification(key);\n\n    return success;\n  }\n\n  /**\n   * Denotes whether Push is supported in the current browser\n   * @returns {boolean}\n   */\n  supported() {\n    let supported = false;\n\n    for (var agent in this._agents)\n      if (this._agents.hasOwnProperty(agent))\n        supported = supported || this._agents[agent].isSupported()\n\n    return supported;\n  }\n\n  /**\n   * Modifies settings or returns all settings if no parameter passed\n   * @param settings\n   */\n  config(settings) {\n    if (typeof settings !== 'undefined' || settings !== null && Util.isObject(settings))\n      Util.objectMerge(this._configuration, settings);\n    return this._configuration;\n  }\n\n  /**\n   * Copies the functions from a plugin to the main library\n   * @param plugin\n   */\n  extend(manifest) {\n    var plugin, Plugin,\n      hasProp = {}.hasOwnProperty;\n\n    if (!hasProp.call(manifest, 'plugin')) {\n      throw new Error(Messages.errors.invalid_plugin);\n    } else {\n      if (hasProp.call(manifest, 'config') && Util.isObject(manifest.config) && manifest.config !== null) {\n        this.config(manifest.config);\n      }\n\n      Plugin = manifest.plugin;\n      plugin = new Plugin(this.config())\n\n      for (var member in plugin) {\n        if (hasProp.call(plugin, member) && Util.isFunction(plugin[member]))\n          this[member] = plugin[member];\n      }\n    }\n  }\n}\n","export default class Util {\n  static isUndefined(obj) {\n    return obj === undefined;\n  }\n\n  static isString(obj) {\n    return typeof obj === 'string';\n  }\n\n  static isFunction(obj) {\n    return obj && {}.toString.call(obj) === '[object Function]';\n  }\n\n  static isObject(obj) {\n    return typeof obj === 'object'\n  }\n\n  static objectMerge(target, source) {\n    for (var key in source) {\n      if (target.hasOwnProperty(key) && this.isObject(target[key]) && this.isObject(source[key])) {\n        this.objectMerge(target[key], source[key]);\n      } else {\n        target[key] = source[key]\n      }\n    }\n  }\n}\n","export default class AbstractAgent {\n  constructor(win) {\n    this._win = win;\n  }\n}\n","import AbstractAgent from './AbstractAgent';\nimport Util from '../Util';\n\n/**\n * Notification agent for modern desktop browsers:\n * Safari 6+, Firefox 22+, Chrome 22+, Opera 25+\n */\nexport default class DesktopAgent extends AbstractAgent {\n\n  /**\n   * Returns a boolean denoting support\n   * @returns {Boolean} boolean denoting whether webkit notifications are supported\n   */\n  isSupported() {\n    return this._win.Notification !== undefined;\n  }\n\n  /**\n   * Creates a new notification\n   * @param title - notification title\n   * @param options - notification options array\n   * @returns {Notification}\n   */\n  create(title, options) {\n    return new this._win.Notification(\n      title,\n      {\n        icon: (Util.isString(options.icon) || Util.isUndefined(options.icon)) ? options.icon : options.icon.x32,\n        body: options.body,\n        tag: options.tag,\n        requireInteraction: options.requireInteraction\n      }\n    );\n  }\n\n  /**\n   * Close a given notification\n   * @param notification - notification to close\n   */\n  close(notification) {\n    notification.close();\n  }\n}\n","import AbstractAgent from './AbstractAgent';\nimport Util from '../Util';\n\n/**\n * Notification agent for IE9\n */\nexport default class MSAgent extends AbstractAgent {\n\n  /**\n   * Returns a boolean denoting support\n   * @returns {Boolean} boolean denoting whether webkit notifications are supported\n   */\n  isSupported() {\n    return (this._win.external !== undefined) && (this._win.external.msIsSiteMode !== undefined);\n  }\n\n  /**\n   * Creates a new notification\n   * @param title - notification title\n   * @param options - notification options array\n   * @returns {Notification}\n   */\n  create(title, options) {\n    /* Clear any previous notifications */\n    this._win.external.msSiteModeClearIconOverlay();\n\n    this._win.external.msSiteModeSetIconOverlay(\n      ((Util.isString(options.icon) || Util.isUndefined(options.icon))\n        ? options.icon\n        : options.icon.x16), title\n    );\n\n    this._win.external.msSiteModeActivate();\n\n    return null;\n  }\n\n  /**\n   * Close a given notification\n   * @param notification - notification to close\n   */\n  close() {\n    this._win.external.msSiteModeClearIconOverlay()\n  }\n}\n","import AbstractAgent from './AbstractAgent';\nimport Util from '../Util';\nimport Messages from '../Messages';\n\n/**\n * Notification agent for modern desktop browsers:\n * Safari 6+, Firefox 22+, Chrome 22+, Opera 25+\n */\nexport default class MobileChromeAgent extends AbstractAgent {\n\n  /**\n   * Returns a boolean denoting support\n   * @returns {Boolean} boolean denoting whether webkit notifications are supported\n   */\n  isSupported() {\n    return this._win.navigator !== undefined &&\n      this._win.navigator.serviceWorker !== undefined;\n  }\n\n  /**\n   * Returns the function body as a string\n   * @param func\n   */\n  getFunctionBody(func) {\n    return func.toString().match(/function[^{]+{([\\s\\S]*)}$/)[1];\n  }\n\n  /**\n   * Creates a new notification\n   * @param title - notification title\n   * @param options - notification options array\n   * @returns {Notification}\n   */\n  create(id, title, options, serviceWorker, callback) {\n    /* Register ServiceWorker */\n    this._win.navigator.serviceWorker.register(serviceWorker);\n\n    this._win.navigator.serviceWorker.ready.then(registration => {\n      /* Local data the service worker will use */\n      let localData = {\n        id: id,\n        link: options.link,\n        origin: document.location.href,\n        onClick: (Util.isFunction(options.onClick)) ? this.getFunctionBody(options.onClick) : '',\n        onClose: (Util.isFunction(options.onClose)) ? this.getFunctionBody(options.onClose) : ''\n      };\n\n      /* Merge the local data with user-provided data */\n      if (options.data !== undefined && options.data !== null)\n        localData = Object.assign(localData, options.data);\n\n      /* Show the notification */\n      registration.showNotification(\n        title,\n        {\n          icon: options.icon,\n          body: options.body,\n          vibrate: options.vibrate,\n          tag: options.tag,\n          data: localData,\n          requireInteraction: options.requireInteraction,\n          silent: options.silent\n        }\n      ).then(() => {\n\n        registration.getNotifications().then(notifications => {\n          /* Send an empty message so the ServiceWorker knows who the client is */\n          registration.active.postMessage('');\n\n          /* Trigger callback */\n          callback(notifications);\n        });\n      }).catch(function(error) {\n        throw new Error(Messages.errors.sw_notification_error + error.message);\n      });\n    }).catch(function(error) {\n      throw new Error(Messages.errors.sw_registration_error + error.message);\n    });\n  }\n\n  /**\n   * Close all notification\n   */\n  close() {\n    // Can't do this with service workers\n  }\n}\n","import AbstractAgent from './AbstractAgent';\n\n/**\n * Notification agent for modern desktop browsers:\n * Safari 6+, Firefox 22+, Chrome 22+, Opera 25+\n */\nexport default class MobileFirefoxAgent extends AbstractAgent {\n\n  /**\n   * Returns a boolean denoting support\n   * @returns {Boolean} boolean denoting whether webkit notifications are supported\n   */\n  isSupported() {\n    return this._win.navigator.mozNotification !== undefined;\n  }\n\n  /**\n   * Creates a new notification\n   * @param title - notification title\n   * @param options - notification options array\n   * @returns {Notification}\n   */\n  create(title, options) {\n    let notification = this._win.navigator.mozNotification.createNotification(\n      title,\n      options.body,\n      options.icon\n    );\n\n    notification.show();\n\n    return notification;\n  }\n}\n","import AbstractAgent from './AbstractAgent';\n\n/**\n * Notification agent for old Chrome versions (and some) Firefox\n */\nexport default class WebKitAgent extends AbstractAgent {\n\n  /**\n   * Returns a boolean denoting support\n   * @returns {Boolean} boolean denoting whether webkit notifications are supported\n   */\n  isSupported() {\n    return this._win.webkitNotifications !== undefined;\n  }\n\n  /**\n   * Creates a new notification\n   * @param title - notification title\n   * @param options - notification options array\n   * @returns {Notification}\n   */\n  create(title, options) {\n    let notification = this._win.webkitNotifications.createNotification(\n      options.icon,\n      title,\n      options.body\n    );\n\n    notification.show();\n\n    return notification;\n  }\n\n  /**\n   * Close a given notification\n   * @param notification - notification to close\n   */\n  close(notification) {\n    notification.cancel();\n  }\n}\n","import Push from './classes/Push';\n\nmodule.exports = new Push(typeof window !== 'undefined' ? window : this);\n"]}