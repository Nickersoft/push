/**
 * Push.js v1.0-beta
 * =================
 * A compact, cross-browser solution for the JavaScript Notifications API
 *
 * Credits
 * -------
 * Tsvetan Tsvetkov (ttsvetko)
 * Alex Gibson (alexgibson)
 *
 * License
 * -------
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015-2017 Tyler Nickerson
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @preserve
 */
(function(e,i){"use strict";if(typeof define==="function"&&define.amd){define(function(){return new(i(e,e.document))})}else if(typeof module!=="undefined"&&module.exports){module.exports=new(i(e,e.document))}else{e.Push=new(i(e,e.document))}})(typeof window!=="undefined"?window:this,function(e,i){var n=function(){var i=this,n=function(e){return e===undefined},t=function(e){return typeof e==="string"},o=function(e){return typeof e==="object"},r=function(e){return e&&{}.toString.call(e)==="[object Function]"},s=0,c="PushError: push.js is incompatible with browser.",a={},f=null,u=function(i){var n=false,t=a[i];if(typeof t!=="undefined"){if(t.close){t.close()}else if(t.cancel){t.cancel()}else if(e.external&&e.external.msIsSiteMode){e.external.msSiteModeClearIconOverlay()}else{n=true;throw new Error("Unable to close notification: unknown interface")}if(!n){return d(i)}}return false},l=function(e){var i=s;a[i]=e;s++;return i},d=function(e){var i={},n=false,t;for(t in a){if(a.hasOwnProperty(t)){if(t!=e){i[t]=a[t]}else{n=true}}}a=i;return n},m=function(e,i){var n;n={get:function(){return a[e]},close:function(){u(e)}};if(i.timeout){setTimeout(function(){n.close()},i.timeout)}return n},v=function(o,c,a){var f,u;c=c||{};u=function(e){d(e);if(r(c.onClose)){c.onClose.call(this,f)}};if(e.Notification){try{f=new e.Notification(o,{icon:t(c.icon)||n(c.icon)?c.icon:c.icon.x32,body:c.body,tag:c.tag,requireInteraction:c.requireInteraction,silent:c.silent})}catch(n){if(e.navigator){e.navigator.serviceWorker.register(i.config.serviceWorker);e.navigator.serviceWorker.ready.then(function(e){var i={id:s,link:c.link,origin:document.location.href,onClick:r(c.onClick)?c.onClick.toString():"",onClose:r(c.onClose)?c.onClose.toString():""};if(typeof c.data!=="undefined"&&c.data!==null)i=Object.assign(i,c.data);e.showNotification(o,{icon:c.icon,body:c.body,vibrate:c.vibrate,tag:c.tag,data:i,requireInteraction:c.requireInteraction}).then(function(){var i;e.getNotifications().then(function(n){i=l(n[n.length-1]);e.active.postMessage("");navigator.serviceWorker.addEventListener("message",function(e){var i=JSON.parse(e.data);if(i.action==="close"&&Number.isInteger(i.id))d(i.id)});a(m(i,c))})})})}}}else if(e.webkitNotifications){f=e.webkitNotifications.createNotification(c.icon,o,c.body);f.show()}else if(navigator.mozNotification){f=navigator.mozNotification.createNotification(o,c.body,c.icon);f.show()}else if(e.external&&e.external.msIsSiteMode()){e.external.msSiteModeClearIconOverlay();e.external.msSiteModeSetIconOverlay(t(c.icon)||n(c.icon)?c.icon:c.icon.x16,o);e.external.msSiteModeActivate();f={}}else{throw new Error("Unable to create notification: unknown interface")}if(typeof f!=="undefined"){var v=l(f),w=m(v,c);if(r(c.onShow))f.addEventListener("show",c.onShow);if(r(c.onError))f.addEventListener("error",c.onError);if(r(c.onClick))f.addEventListener("click",c.onClick);f.addEventListener("close",function(){u(v)});f.addEventListener("cancel",function(){u(v)});a(w)}a({})},w=function(e,i){for(var n in i){if(e.hasOwnProperty(n)&&o(e[n])&&o(i[n])){w(e[n],i[n])}else{e[n]=i[n]}}},h={DEFAULT:"default",GRANTED:"granted",DENIED:"denied"},g=[h.GRANTED,h.DEFAULT,h.DENIED],N={serviceWorker:"./serviceWorker.js"};i.Permission=h;i.Permission.request=function(n,t){var o=i.Permission.get();if(!i.isSupported){throw new Error(c)}var r=function(e){switch(e){case i.Permission.GRANTED:if(n)n();break;case i.Permission.DENIED:if(t)t();break}};if(o!==i.Permission.DEFAULT){r(o)}else if(e.Notification&&e.Notification.requestPermission){Notification.requestPermission(r)}else if(e.webkitNotifications&&e.webkitNotifications.checkPermission){e.webkitNotifications.requestPermission(r)}else{throw new Error(c)}};i.Permission.has=function(){return h.get()===h.GRANTED};i.Permission.get=function(){var n;if(!i.isSupported){throw new Error(c)}if(e.Notification&&e.Notification.permissionLevel){n=e.Notification.permissionLevel}else if(e.webkitNotifications&&e.webkitNotifications.checkPermission){n=g[e.webkitNotifications.checkPermission()]}else if(e.Notification&&e.Notification.permission){n=e.Notification.permission}else if(navigator.mozNotification){n=h.GRANTED}else if(e.external&&e.external.msIsSiteMode()!==undefined){n=e.external.msIsSiteMode()?h.GRANTED:h.DEFAULT}else{throw new Error(c)}return n};i.extend=function(e){var n,t,o={}.hasOwnProperty;if(!o.call(e,"plugin")){throw new Error("PushError: plugin class missing from plugin manifest (invalid plugin). Please check the documentation")}else{if(o.call(e,"config")){i.config(e.config)}t=e.plugin;n=new t(i.config());for(var s in n){if(o.call(n,s)&&r(n[s]))i[s]=n[s]}}};i.isSupported=function(){var i=false;try{i=!!(e.Notification||e.webkitNotifications||navigator.mozNotification||e.external&&e.external.msIsSiteMode()!==undefined)}catch(e){}return i}();i.create=function(e,n){var o;if(!i.isSupported){throw new Error(c)}if(!t(e)){throw new Error("PushError: Title of notification must be a string")}if(!i.Permission.has()){o=function(t,o){i.Permission.request(function(){try{v(e,n,t)}catch(e){o(e)}},function(){o("Permission request declined")})}}else{o=function(i,t){try{v(e,n,i)}catch(e){t(e)}}}return new Promise(o)};i.count=function(){var e=0,i;for(i in a)e++;return e};i.close=function(e){var i,n;for(i in a){n=a[i];if(n.tag===e){return u(i)}}};i.clear=function(){var e=true;for(key in a)e=e&&u(key);return e};i.config=function(e){if(typeof e!=="undefined"||e!==null&&o(e))w(N,e);return N}};return n});